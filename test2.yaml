::let:
  x: foo
  y: bar
  $x: qux
  $y: quuz

  template:
    - ::ref: x
    - ::ref: y
    - ::ref: $x
    - ::ref: $y
    - ::ref: $z

formatted:
  ::format: hello <<x>> woohoo <<y>> yeah <<$x>> and <<$y>>

cool:
  ::format:
    some-<<x>>: <<y>>
    woohoo: <<x>>/<<y>>

list:
  - ::ref: x
  - ::ref: y
  - ::ref: $x
  - ::ref: $y
  - ::ref: SHELL
  - ::ref: HOSTNAME
    ::else: unknown

x:
  ::let:
    something:
      ::ref: $m
  y:
    - ::ref: something
      ::let:
        $m: 3
      ::else:
        ::ref: $z
    - ::ref: $q
      ::else: All okay.

applied:
  ::let:
    x: keyfoo
    y: keybar
    $x: keyqux
    $y: keyquuz
    $z: zeeee

  ::call template:
    $y: callquuz

applied2:
  ::call: template